{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h1>üõ† Qu·∫£n l√Ω Node</h1>

  <!-- N√∫t m·ªü modal Th√™m -->
  <button class="btn btn-primary mb-3" onclick="openModal()">‚ûï Th√™m Node</button>

  <!-- Modal Th√™m/S·ª≠a Node -->
  <div class="modal fade" id="modalConfig" tabindex="-1">
    <div class="modal-dialog">
      <form method="post" action="/config/add_or_update" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modalTitle">‚ûï Th√™m Config Node</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="nodeId">

          <div class="mb-3">
            <input name="node"      id="nodeName"     class="form-control" placeholder="Node"    required>
          </div>
          <div class="mb-3">
            <select name="type"     id="nodeType"     class="form-select"   required>
              <option value="">Ch·ªçn lo·∫°i node</option>
              {% for t in ['MME','MSS','TSS','PGW','SBG'] %}
              <option value="{{ t }}">{{ t }}</option>
              {% endfor %}
            </select>
          </div>
          <div class="mb-3">
            <input name="ip"        id="nodeIp"       class="form-control" placeholder="IP"      required>
          </div>
          <div class="mb-3">
            <input name="user"      id="nodeUser"     class="form-control" placeholder="User"    required>
          </div>
          <div class="mb-3">
            <input name="password"  id="nodePassword" type="password" class="form-control" placeholder="Password" required>
          </div>
          <div class="mb-3">
            <input name="path"      id="nodePath"     class="form-control" placeholder="Path"    required>
          </div>

          <div class="form-check mb-3">
            <input class="form-check-input" type="checkbox" id="nodeStatus" name="status">
            <label class="form-check-label" for="nodeStatus">Active</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-success">L∆∞u</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </form>
    </div>
  </div>

  <!-- B·∫£ng hi·ªÉn th·ªã Node -->
  <table class="table table-bordered table-hover table-striped">
    <thead class="table-dark">
      <tr>
        <th>Node</th><th>Type</th><th>IP</th><th>User</th><th>Path</th><th>Status</th><th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row[1] }}</td>
        <td>{{ row[2] }}</td>
        <td>{{ row[3] }}</td>
        <td>{{ row[4] }}</td>
        <td>{{ row[6] }}</td>
        <td>
          {% if row[7] == 1 %}
            <span class="badge bg-success">Active</span>
          {% else %}
            <span class="badge bg-secondary">Inactive</span>
          {% endif %}
        </td>
        <td>
          <!-- Edit: truy·ªÅn lu√¥n gi√° tr·ªã status -->
          <button
            class="btn btn-warning btn-sm"
            onclick="openModal(
              {{row[0]}},
              '{{row[1]}}','{{row[2]}}','{{row[3]}}','{{row[4]}}','{{row[5]}}','{{row[6]}}',
              {{ row[7] }}
            )"
          >‚úèÔ∏è</button>
          <a href="/config/delete/{{ row[0] }}" class="btn btn-danger btn-sm">‚ùå</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
// M·ªü modal, n·∫øu c√≥ id th√¨ s·ª≠a, kh√¥ng th√¨ th√™m m·ªõi
function openModal(id, node, type, ip, user, password, path, status) {
  document.getElementById('modalTitle').innerText = id ? '‚úèÔ∏è S·ª≠a Config Node' : '‚ûï Th√™m Config Node';
  document.getElementById('nodeId').value       = id || '';
  document.getElementById('nodeName').value     = node || '';
  document.getElementById('nodeType').value     = type || '';
  document.getElementById('nodeIp').value       = ip || '';
  document.getElementById('nodeUser').value     = user || '';
  document.getElementById('nodePassword').value = password || '';
  document.getElementById('nodePath').value     = path || '';
  document.getElementById('nodeStatus').checked = status === 1;

  new bootstrap.Modal(document.getElementById('modalConfig')).show();
}
</script>
{% endblock %}
