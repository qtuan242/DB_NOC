{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h1>‚öôÔ∏è C·∫•u h√¨nh Ng∆∞·ª°ng KPI</h1>

  <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#nguongModal" onclick="openAddModal()">
    ‚ûï Th√™m Ng∆∞·ª°ng
  </button>

  <!-- Modal -->
  <div class="modal fade" id="nguongModal" tabindex="-1">
    <div class="modal-dialog">
      <form method="POST" action="{{ url_for('config_nguong_add_or_update') }}" class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">üìù Th√™m / S·ª≠a Ng∆∞·ª°ng KPI</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="id" id="nguong_id">

          <div class="mb-3">
            <label for="kpi_name" class="form-label">KPI Name</label>
            <input type="text" name="kpi_name" id="kpi_name" class="form-control" required>
          </div>

          <div class="mb-3">
            <label for="type" class="form-label">Lo·∫°i Node</label>
            <select name="type" id="type" class="form-select" required>
              <option value="" disabled selected>Ch·ªçn lo·∫°i node</option>
              {% for t in ['MME','PGW','SBG'] %}
              <option value="{{ t }}">{{ t }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="mb-3">
            <label for="chuky" class="form-label">Chu k·ª≥</label>
            <input type="number" step="0.01" name="chuky" id="chuky" class="form-control">
          </div>

          <div class="mb-3">
            <label for="nguong_fix" class="form-label">Ng∆∞·ª°ng Fix</label>
            <input type="number" step="0.01" name="nguong_fix" id="nguong_fix" class="form-control">
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="DB" id="DB">
            <label class="form-check-label" for="DB">DashBoard Chung</label>
          </div>

          <div class="form-check mb-2">
            <input class="form-check-input" type="checkbox" name="status" id="status">
            <label class="form-check-label" for="status">K√≠ch ho·∫°t KPI</label>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">üíæ L∆∞u</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
        </div>
      </form>
    </div>
  </div>

  <table class="table table-bordered table-hover">
    <thead class="table-dark">
      <tr>
        <th>KPI Name</th>
        <th>Lo·∫°i Node</th>
        <th>Chu k·ª≥</th>
        <th>Ng∆∞·ª°ng Fix</th>
        <th>DashBoard Chung</th>
        <th>Status</th>
        <th>H√†nh ƒë·ªông</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>{{ row[1] }}</td>
        <td>{{ row[4] }}</td>
        <td>{{ row[2] }}</td>
        <td>{{ row[3] }}</td>
        <td>{{ "‚úÖ" if row[5] else "" }}</td>
        <td>{{ "üü¢" if row[6] else "üî¥" }}</td>
        <td>
          <button class="btn btn-warning btn-sm"
                  onclick="editNguong('{{ row[0] }}', '{{ row[1] }}', '{{ row[2] }}', '{{ row[3] }}', '{{ row[4] }}', '{{ row[5] }}', '{{ row[6] }}')"
                  data-bs-toggle="modal" data-bs-target="#nguongModal">‚úèÔ∏è</button>
          <a href="{{ url_for('config_nguong_delete', id=row[0]) }}" class="btn btn-danger btn-sm">‚ùå</a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<script>
  function editNguong(id, name, ema, fix, type, db, status) {
    document.getElementById('nguong_id').value = id;
    document.getElementById('kpi_name').value = name;
    document.getElementById('chuky').value = ema;
    document.getElementById('nguong_fix').value = fix;
    document.getElementById('type').value = type;
    document.getElementById('DB').checked = (db == "1");
    document.getElementById('status').checked = (status == "1");
  }

  function openAddModal() {
    document.getElementById('nguong_id').value = '';
    document.getElementById('kpi_name').value = '';
    document.getElementById('chuky').value = '';
    document.getElementById('nguong_fix').value = '';
    document.getElementById('type').value = '';
    document.getElementById('DB').checked = false;
    document.getElementById('status').checked = false;
  }
</script>
{% endblock %}
